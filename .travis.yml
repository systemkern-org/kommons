sudo: required

language: java
jdk: oraclejdk8

services:
  - docker

cache:
  directories:
  - $HOME/.m2
  
before_deploy:
  - mvn help:evaluate -N -Dexpression=project.version|grep -v '\['
  - export project_version=$(mvn help:evaluate -N -Dexpression=project.version|grep -v '\[')

script:
# -B batch mode makes Maven less verbose
  - mvn -B clean verify

after_success:
  - "curl -T kommons/target/kommons-$project_version.jar -u \${snapsot-ftp-user}:\${snapshot-ftp-password} ftp://\${snapshot-ftp-server}/"

## Create release in GitHub    
deploy:
    provider: releases
    file:
        - kommons/target/kommons-$project_version.jar
    skip_cleanup: true
    on:
        repo: systemkern/kommons
    name: $project_version